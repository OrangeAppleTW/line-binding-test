<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ©˜å­è˜‹æœç¨‹å¼å­¸è‹‘ æœƒå“¡ç¶å®š (æ¨¡æ“¬æ¼”ç¤ºç‰ˆ)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
        background-color: #ffffff; 
      }
      
      .container { 
        max-width: 600px; 
        margin-top: 20px; 
        padding: 20px;
      }

      .content-area { 
        border: none; 
        box-shadow: none; 
      }

      .user-id-display { 
        font-size: 0.85rem; 
        color: #6c757d; 
        background: #f8f9fa; 
        padding: 5px 15px; 
        border-radius: 20px; 
        display: inline-block; 
        margin-bottom: 25px; 
      }

      /* è‡ªå®šç¾©æ©˜è‰²æŒ‰éˆ• */
      .btn-orange {
        background-color: #ffa300;
        border-color: #ffa300;
        color: white;
        font-weight: bold;
      }
      .btn-orange:hover, .btn-orange:active, .btn-orange:focus {
        background-color: #e59200;
        border-color: #e59200;
        color: white;
      }
      .btn-orange:disabled {
        background-color: #ffe0b2;
        border-color: #ffe0b2;
      }

      /* é©—è­‰ç¢¼è¼¸å…¥æ¡†æ¨£å¼ */
      .otp-letter-input {
        letter-spacing: 5px;
        text-align: center;
        font-size: 1.2rem;
      }

      /* é–‹ç™¼è€…æ¸¬è©¦å€å¡Šæ¨£å¼ (ä¸èµ·çœ¼) */
      .dev-tools {
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px dashed #eee;
        font-size: 0.75rem;
        color: #ccc;
        text-align: center;
      }
      .dev-tools:hover {
        color: #999;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="content-area">
        
        <h4 class="mb-4 text-center fw-bold">æ©˜å­è˜‹æœç¨‹å¼å­¸è‹‘<br>æœƒå“¡ç¶å®š</h4>
        
        <!-- æ¨¡æ“¬é¡¯ç¤º LINE User ID -->
        <div class="text-center">
          <span id="userIdDisplay" class="user-id-display">ID: U12345678mock (æ¨¡æ“¬)</span>
        </div>

        <div id="mainForm">
          <!-- æ­¥é©Ÿ 1: è¼¸å…¥æ‰‹æ©Ÿ -->
          <p id="instructionText" class="text-muted text-center small mb-4">
            è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼ä»¥é€²è¡Œé©—è­‰ã€‚
          </p>

          <div class="mb-4">
            <label for="phone" class="form-label fw-bold">æ‰‹æ©Ÿè™Ÿç¢¼</label>
            <input type="tel" id="phone" class="form-control form-control-lg" placeholder="ä¾‹å¦‚ï¼š0912345678">
          </div>

          <!-- æ­¥é©Ÿ 2: é©—è­‰ç¢¼èˆ‡è£œè¨»å†Šå€å¡Š (åˆå§‹éš±è—) -->
          <div id="step2Section" style="display: none;">
            
            <!-- ç‹€æ…‹æç¤ºè¨Šæ¯ -->
            <div id="statusMessage" class="alert alert-light border mb-3 text-center" role="alert" style="font-size: 0.9rem;">
              <!-- JS å‹•æ…‹å¡«å…¥ -->
            </div>

            <div class="mb-4">
              <label for="otpCode" class="form-label fw-bold">ç°¡è¨Šé©—è­‰ç¢¼</label>
              <input type="text" id="otpCode" class="form-control form-control-lg otp-letter-input" placeholder="è«‹è¼¸å…¥ 4 ä½æ•¸é©—è­‰ç¢¼" maxlength="4">
              <div class="form-text text-end"><a href="#" class="text-muted" style="text-decoration: none;">æ²’æ”¶åˆ°é©—è­‰ç¢¼ï¼Ÿ</a></div>
            </div>

            <!-- Email è£œè¨»å†Šæ¬„ä½ (åƒ…åœ¨æ–°æœƒå“¡æ™‚é¡¯ç¤º) -->
            <div id="emailSection" class="mb-4" style="display: none;">
              <label for="email" class="form-label fw-bold text-orange">é›»å­ä¿¡ç®± (è¨»å†Šç”¨)</label>
              <input type="email" id="email" class="form-control form-control-lg" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email">
              <div class="form-text">æ­¤æ‰‹æ©Ÿè™Ÿç¢¼å°šæœªè¨»å†Šï¼Œè«‹æä¾› Email ä»¥å®Œæˆå¸³è™Ÿå»ºç«‹ã€‚</div>
            </div>

          </div>
          
          <!-- æŒ‰éˆ• -->
          <button id="actionBtn" onclick="handleAction()" class="btn btn-orange w-100 btn-lg">
            ç™¼é€é©—è­‰ç¢¼
          </button>
        </div>
        
        <!-- Loading å‹•ç•« -->
        <div id="loading" class="text-center mt-5" style="display:none;">
          <div class="spinner-border text-secondary" role="status"></div>
          <p class="mt-2 text-muted">è³‡æ–™ç¢ºèªä¸­...</p>
        </div>

        <!-- æˆåŠŸç•«é¢ -->
        <div id="successView" class="text-center mt-4" style="display: none;">
            <div class="mb-3" style="font-size: 3rem;">ğŸ‰</div>
            <h4 class="fw-bold text-success">ç¶å®šæˆåŠŸï¼</h4>
            <p class="text-muted">æ‚¨å·²æˆåŠŸé€£çµæœƒå“¡è³‡æ–™ã€‚<br>ç¾åœ¨æ‚¨å¯ä»¥é—œé–‰æ­¤è¦–çª—ã€‚</p>
            <button onclick="window.close()" class="btn btn-outline-secondary mt-3">é—œé–‰è¦–çª—</button>
        </div>

      </div>

      <!-- ä¸èµ·çœ¼çš„ PM æ¸¬è©¦é–‹é—œ -->
      <div class="dev-tools">
        <label>
            <input type="checkbox" id="mockIsMember"> [é–‹ç™¼æ¸¬è©¦] æ¨¡æ“¬ï¼šæ­¤æ‰‹æ©Ÿç‚ºã€Œå·²ç¶“æ˜¯æœƒå“¡ã€
        </label>
      </div>
    </div>

    <script>
      // ç‹€æ…‹è®Šæ•¸
      let currentStep = 1; // 1: è¼¸å…¥æ‰‹æ©Ÿ, 2: è¼¸å…¥é©—è­‰ç¢¼/Email
      const btn = document.getElementById('actionBtn');
      const loading = document.getElementById('loading');
      const form = document.getElementById('mainForm');
      const phoneInput = document.getElementById('phone');
      
      // æŒ‰éˆ•é»æ“Šé‚è¼¯
      function handleAction() {
        if (currentStep === 1) {
            sendVerificationCode();
        } else {
            submitFinalBinding();
        }
      }

      // æ­¥é©Ÿ 1: ç™¼é€é©—è­‰ç¢¼ (æ¨¡æ“¬æ‰“ API ç¢ºèªæœƒå“¡ç‹€æ…‹)
      function sendVerificationCode() {
        const phone = phoneInput.value;
        if (!phone) {
            alert('è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼');
            return;
        }

        // åˆ‡æ› UI åˆ° Loading
        form.style.display = 'none';
        loading.style.display = 'block';

        // æ¨¡æ“¬ API å»¶é² 1 ç§’
        setTimeout(() => {
            loading.style.display = 'none';
            form.style.display = 'block';

            // é€²å…¥æ­¥é©Ÿ 2
            currentStep = 2;
            renderStep2UI();
        }, 1000); // 1ç§’å»¶é²
      }

      // æ¸²æŸ“æ­¥é©Ÿ 2 çš„ UI (æ ¹æ“š PM é–‹é—œæ±ºå®šé¡¯ç¤ºå…§å®¹)
      function renderStep2UI() {
        const isMember = document.getElementById('mockIsMember').checked;
        const step2Section = document.getElementById('step2Section');
        const emailSection = document.getElementById('emailSection');
        const statusMsg = document.getElementById('statusMessage');
        
        // é–å®šæ‰‹æ©Ÿæ¬„ä½ï¼Œæ”¹ç‚ºå”¯è®€
        phoneInput.disabled = true;
        phoneInput.classList.add('bg-light');

        // é¡¯ç¤ºé©—è­‰å€åŸŸ
        step2Section.style.display = 'block';
        
        if (isMember) {
            // æƒ…å¢ƒ A: å·²ç¶“æ˜¯æœƒå“¡
            statusMsg.innerHTML = '<span class="text-success fw-bold">âœ“ æ­¡è¿å›ä¾†ï¼</span><br>ç³»çµ±å·²æ‰¾åˆ°æ‚¨çš„æœƒå“¡è³‡æ–™ï¼Œè«‹è¼¸å…¥ç°¡è¨Šé©—è­‰ç¢¼ä»¥å®Œæˆç¶å®šã€‚';
            statusMsg.classList.add('alert-success');
            statusMsg.classList.remove('alert-warning');
            
            // éš±è— Email
            emailSection.style.display = 'none';
        } else {
            // æƒ…å¢ƒ B: ä¸æ˜¯æœƒå“¡
            statusMsg.innerHTML = '<span class="text-danger fw-bold">! å°šæœªè¨»å†Š</span><br>æ­¤æ‰‹æ©Ÿå°šæœªå»ºç«‹æœƒå“¡è³‡æ–™ã€‚è«‹è¼¸å…¥é©—è­‰ç¢¼ä¸¦æä¾› Email ä»¥åŒæ­¥å®Œæˆè¨»å†Šã€‚';
            statusMsg.classList.add('alert-warning');
            statusMsg.classList.remove('alert-success');

            // é¡¯ç¤º Email
            emailSection.style.display = 'block';
        }

        // æ›´æ”¹æŒ‰éˆ•æ–‡å­—
        btn.innerText = isMember ? 'ç¢ºèªç¶å®š' : 'è¨»å†Šä¸¦ç¶å®š';
        
        // æ›´æ”¹ä¸Šæ–¹æŒ‡ç¤ºæ–‡å­—
        document.getElementById('instructionText').innerText = 'é©—è­‰ç¢¼å·²ç™¼é€è‡³æ‚¨çš„æ‰‹æ©Ÿ';
      }

      // æ­¥é©Ÿ 3: é€å‡ºç¶å®š
      function submitFinalBinding() {
        const otp = document.getElementById('otpCode').value;
        const isMember = document.getElementById('mockIsMember').checked;

        if (!otp) {
            alert('è«‹è¼¸å…¥ç°¡è¨Šé©—è­‰ç¢¼');
            return;
        }

        // å¦‚æœæ˜¯æ–°æœƒå“¡ï¼Œæª¢æŸ¥ Email
        if (!isMember) {
            const email = document.getElementById('email').value;
            if (!email) {
                alert('è«‹è¼¸å…¥ Email ä»¥å®Œæˆè¨»å†Š');
                return;
            }
        }

        // æ¨¡æ“¬æœ€å¾Œé€å‡º
        form.style.display = 'none';
        loading.style.display = 'block';

        setTimeout(() => {
            loading.style.display = 'none';
            document.getElementById('successView').style.display = 'block';
        }, 1500);
      }
    </script>
  </body>
</html>
